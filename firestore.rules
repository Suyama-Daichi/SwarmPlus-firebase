rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      // 認証済み
      function isAuthenticated() {
        return request.auth.uid != null
      }

      // 匿名認証
      function isAnonymousAuth() {
        return request.auth.uid != null && request.auth.token.firebase.sign_in_provider == 'anonymous'
      }

      // モバイルユーザー
      function isMobileUser() {
        return get(/databases/$(database)/documents/users/$(request.auth.uid)).data != null
      }

      // 自身のユーザー
      function isMyUser(userId) {
        return request.auth.uid == userId;
      }

      // モバイルユーザー
      match /users/{userId} {
        allow read: if isMyUser();
        allow create: if isAuthenticated();
        allow update: if isMyUser(userId)

        // チェックイン
        match /checkins/{userFollowingIdsId} {
          allow read: if isMyUser();
          allow write: if isMyUser(userId);
        }
      }
    }
  }
